{% extends "base.html" %}

{% block content %}
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-lg-6">
            <div class="card">
                <div class="card-body p-5">
                    <h3 class="card-title mb-4">Complete Your Subscription</h3>
                    <p class="text-muted mb-4">Subscribe to Trading Analyzer Pro for $9.99/month</p>
                    
                    <form id="payment-form">
                        <div class="mb-3">
                            <label class="form-label">Card Number</label>
                            <div id="card-element" class="form-control"></div>
                        </div>
                        <div class="mb-3">
                            <button id="submit-button" class="btn btn-primary w-100">
                                <span id="button-text">Pay $9.99</span>
                            </button>
                        </div>
                        <div id="payment-message" class="alert" role="alert"></div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://js.stripe.com/v3/"></script>
<script>
const stripe = Stripe('pk_test_...'); // Replace with your Stripe publishable key
const elements = stripe.elements();
const cardElement = elements.create('card');
cardElement.mount('#card-element');

const form = document.getElementById('payment-form');
form.addEventListener('submit', async (event) => {
    event.preventDefault();
    
    const {error, paymentMethod} = await stripe.createPaymentMethod({
        type: 'card',
        card: cardElement,
    });
    
    if (error) {
        document.getElementById('payment-message').textContent = error.message;
    } else {
        // Send paymentMethod.id to your server
        const response = await fetch('/create-checkout-session', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({payment_method_id: paymentMethod.id})
        });
        
        const session = await response.json();
        const result = await stripe.redirectToCheckout({sessionId: session.id});
        
        if (result.error) {
            document.getElementById('payment-message').textContent = result.error.message;
        }
    }
});
</script>
{% endblock %}